<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Qu√©t QR & C·ªông T·ªïng Ti·ªÅn</title>
  <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
  <style>
    body { font-family: Arial; background: #f4f4f4; padding: 20px; text-align: center; }
    h1 { color: #333; }
    #reader { width: 300px; margin: 0 auto; }
    table {
      width: 90%; margin: 20px auto; border-collapse: collapse; background: #fff;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    th, td {
      padding: 10px; border: 1px solid #ccc; text-align: center;
    }
    th { background: #eee; }
    #total {
      font-size: 18px;
      font-weight: bold;
      margin-top: 20px;
    }
  </style>
</head>
<body>

  <h1>üì∑ Qu√©t v√† c·ªông t·ªïng ti·ªÅn QR</h1>
  <div id="reader"></div>

  <table id="resultTable">
    <thead>
      <tr>
        <th>#</th>
        <th>Ng√¢n h√†ng</th>
        <th>S·ªë t√†i kho·∫£n</th>
        <th>S·ªë ti·ªÅn</th>
        <th>Ghi ch√∫</th>
      </tr>
    </thead>
    <tbody id="resultBody"></tbody>
  </table>

  <div id="total">T·ªïng ti·ªÅn: 0 VND</div>

  <script>
    let totalAmount = 0;
    let scannedData = new Set(); // ƒë·ªÉ lo·∫°i tr√πng
    let count = 0;

    function parseQR(text) {
      const bankMatch = text.match(/A00000072701(\d{6})/); // m√£ ng√¢n h√†ng
      const accMatch = text.match(/0110\d{7,}/); // s·ªë t√†i kho·∫£n
      const amountMatch = text.match(/5406(\d{1,})/); // s·ªë ti·ªÅn
      const noteMatch = text.match(/62\d{2}([A-Z0-9]+)/); // ghi ch√∫

      return {
        raw: text,
        bank: bankMatch ? bankMatch[1] : 'Kh√¥ng r√µ',
        account: accMatch ? accMatch[0] : 'Kh√¥ng r√µ',
        amount: amountMatch ? parseInt(amountMatch[1]) / 100 : 0,
        note: noteMatch ? noteMatch[1] : 'Kh√¥ng c√≥'
      };
    }

    function onScanSuccess(decodedText, decodedResult) {
      if (scannedData.has(decodedText)) return; // b·ªè qua n·∫øu ƒë√£ qu√©t

      scannedData.add(decodedText);
      const info = parseQR(decodedText);
      totalAmount += info.amount;
      count++;

      // Th√™m d√≤ng v√†o b·∫£ng
      const tbody = document.getElementById("resultBody");
      const row = document.createElement("tr");
      row.innerHTML = `
        <td>${count}</td>
        <td>${info.bank}</td>
        <td>${info.account}</td>
        <td>${info.amount.toLocaleString('vi-VN')} VND</td>
        <td>${info.note}</td>
      `;
      tbody.appendChild(row);

      // C·∫≠p nh·∫≠t t·ªïng
      document.getElementById("total").innerText =
        "T·ªïng ti·ªÅn: " + totalAmount.toLocaleString('vi-VN') + " VND";
    }

    const html5QrcodeScanner = new Html5QrcodeScanner(
      "reader", { fps: 10, qrbox: 250 }, false
    );
    html5QrcodeScanner.render(onScanSuccess);
  </script>

</body>
</html>
