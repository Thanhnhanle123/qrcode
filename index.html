<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Qu√©t QR & C·ªông T·ªïng Ti·ªÅn</title>
  <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
  <style>
    body { font-family: Arial; background: #f4f4f4; padding: 20px; text-align: center; }
    h1 { color: #333; }
    #reader { width: 300px; margin: 0 auto; }
    table {
      width: 90%; margin: 20px auto; border-collapse: collapse; background: #fff;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    th, td {
      padding: 10px; border: 1px solid #ccc; text-align: center;
    }
    th { background: #eee; }
    #total {
      font-size: 18px;
      font-weight: bold;
      margin-top: 20px;
    }
  </style>
</head>
<body>

  <h1>üì∑ Qu√©t v√† c·ªông t·ªïng ti·ªÅn QR</h1>
  <div id="reader"></div>

  <table id="resultTable">
    <thead>
      <tr>
        <th>#</th>
        <th>Ng√¢n h√†ng</th>
        <th>S·ªë t√†i kho·∫£n</th>
        <th>S·ªë ti·ªÅn</th>
        <th>Ghi ch√∫</th>
      </tr>
    </thead>
    <tbody id="resultBody"></tbody>
  </table>

  <div id="total">T·ªïng ti·ªÅn: 0 VND</div>

  <script>
    let totalAmount = 0;
    let scannedData = new Set(); // ƒë·ªÉ tr√°nh qu√©t tr√πng
    let count = 0;

    const bankCodes = {
      '970422': 'Vietcombank',
      '970436': 'TPBank',
      '970405': 'VietinBank',
      '970418': 'Techcombank',
      '970415': 'ACB',
      '970407': 'BIDV',
      '970403': 'Sacombank',
      '970412': 'MB Bank',
      // B·∫°n c√≥ th·ªÉ th√™m c√°c m√£ ng√¢n h√†ng kh√°c t·∫°i ƒë√¢y n·∫øu c·∫ßn
    };

    function parseQR(text) {
      const bankMatch = text.match(/A00000072701(\d{6})/); // m√£ ng√¢n h√†ng
      const bankCode = bankMatch ? bankMatch[1] : '------';
      const bankName = bankCodes[bankCode] || 'Kh√¥ng r√µ';

      const accMatch = text.match(/0110\d{6,}/); // s·ªë t√†i kho·∫£n b·∫Øt ƒë·∫ßu b·∫±ng 0110
      const account = accMatch ? accMatch[0] : 'Kh√¥ng r√µ';

      const amountMatch = text.match(/54\d{2}(\d{1,})/); // s·ªë ti·ªÅn
      const amount = amountMatch ? parseInt(amountMatch[1]) / 100 : 0;

      const noteMatch = text.match(/62\d{2}([A-Z0-9]+)/); // ghi ch√∫
      const note = noteMatch ? noteMatch[1] : 'Kh√¥ng c√≥';

      return { bank: bankName, account, amount, note };
    }

    function onScanSuccess(decodedText, decodedResult) {
      if (scannedData.has(decodedText)) return; // b·ªè qua n·∫øu tr√πng
      scannedData.add(decodedText);

      const info = parseQR(decodedText);
      totalAmount += info.amount;
      count++;

      const tbody = document.getElementById("resultBody");
      const row = document.createElement("tr");
      row.innerHTML = `
        <td>${count}</td>
        <td>${info.bank}</td>
        <td>${info.account}</td>
        <td>${info.amount.toLocaleString('vi-VN')} VND</td>
        <td>${info.note}</td>
      `;
      tbody.appendChild(row);

      document.getElementById("total").innerText =
        "T·ªïng ti·ªÅn: " + totalAmount.toLocaleString('vi-VN') + " VND";
    }

    const html5QrcodeScanner = new Html5QrcodeScanner(
      "reader", { fps: 10, qrbox: 250 }, false
    );
    html5QrcodeScanner.render(onScanSuccess);
  </script>

</body>
</html>
